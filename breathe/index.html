<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Дыхание — Breathe</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #07070a;
      color: #fff;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .bg {
      position: fixed;
      inset: 0;
      opacity: 0.3;
      pointer-events: none;
      transition: background 1s ease;
    }
    .content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-size: 1rem;
      font-weight: 300;
      color: #71717a;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      margin-bottom: 0.25rem;
    }
    .tagline {
      font-size: 11px;
      color: #52525b;
      margin-bottom: 2.5rem;
    }
    .circle {
      width: 260px;
      height: 260px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.04);
      transition: transform 0.7s ease-in-out, background 0.3s, box-shadow 0.3s;
    }
    .phase-name {
      font-size: 1.25rem;
      font-weight: 300;
      color: rgba(255,255,255,0.9);
      margin-top: 2.5rem;
    }
    .countdown {
      font-size: 3rem;
      font-weight: 200;
      color: #a1a1aa;
      margin-top: 0.75rem;
      font-variant-numeric: tabular-nums;
    }
    .cycles {
      font-size: 0.875rem;
      color: #52525b;
      margin-top: 2rem;
    }
    .patterns {
      position: fixed;
      bottom: 3rem;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }
    .patterns button {
      padding: 0.625rem 1.25rem;
      border-radius: 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
      background: transparent;
      color: #71717a;
    }
    .patterns button:hover { color: #a1a1aa; }
    .patterns button.active {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border-color: rgba(255,255,255,0.15);
    }
    .lang {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      display: flex;
      gap: 0.25rem;
    }
    .lang button {
      padding: 0.375rem 0.75rem;
      border-radius: 0.75rem;
      font-size: 0.75rem;
      border: none;
      cursor: pointer;
      background: transparent;
      color: #52525b;
    }
    .lang button.active {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="bg" id="bg"></div>
  <div class="content">
    <h1 id="title">Дыхание</h1>
    <p class="tagline" id="tagline">Следуй за кругом</p>
    <div class="circle" id="circle"></div>
    <p class="phase-name" id="phaseName">Вдох</p>
    <p class="countdown" id="countdown">4</p>
    <p class="cycles" id="cycles">0 циклов</p>
  </div>
  <div class="patterns">
    <button type="button" data-pattern="box" class="active">Квадрат</button>
    <button type="button" data-pattern="4-7-8">4-7-8</button>
    <button type="button" data-pattern="calm">Спокойное</button>
  </div>
  <div class="lang">
    <button type="button" data-lang="ru" class="active">RU</button>
    <button type="button" data-lang="en">EN</button>
  </div>

  <script>
    const PATTERNS = { box: [4,4,4,4], "4-7-8": [4,7,8,0], calm: [5,2,5,2] };
    const PHASES = ["inhale", "hold", "exhale", "hold"];

    const i18n = {
      ru: {
        title: "Дыхание", tagline: "Следуй за кругом",
        inhale: "Вдох", hold: "Задержка", exhale: "Выдох",
        cycles: "циклов", box: "Квадрат", "4-7-8": "4-7-8", calm: "Спокойное"
      },
      en: {
        title: "Breathe", tagline: "Follow the circle",
        inhale: "Inhale", hold: "Hold", exhale: "Exhale",
        cycles: "cycles", box: "Box", "4-7-8": "4-7-8", calm: "Calm"
      }
    };

    let state = {
      pattern: "box",
      phaseIdx: 0,
      phaseSec: 0,
      cycle: 0,
      lang: localStorage.getItem("breathe-lang") || "ru"
    };

    function getDurations() { return PATTERNS[state.pattern]; }
    function getPhase() { return PHASES[state.phaseIdx % 4]; }
    function getPhaseDuration() { return (getDurations()[state.phaseIdx] ?? 4); }

    function update() {
      const phase = getPhase();
      const dur = getPhaseDuration();
      const progress = dur > 0 ? state.phaseSec / dur : 0;

      let scale = 1;
      if (phase === "inhale") scale = 0.55 + progress * 0.45;
      else if (phase === "exhale") scale = 1 - progress * 0.45;

      const circle = document.getElementById("circle");
      circle.style.transform = `scale(${scale})`;

      if (phase === "inhale") {
        circle.style.background = "radial-gradient(circle at 35% 35%, rgba(34,197,94,0.5), rgba(22,163,74,0.25))";
        circle.style.boxShadow = "0 0 100px rgba(34,197,94,0.35), inset 0 0 80px rgba(34,197,94,0.12)";
      } else if (phase === "exhale") {
        circle.style.background = "radial-gradient(circle at 35% 35%, rgba(59,130,246,0.45), rgba(37,99,235,0.2))";
        circle.style.boxShadow = "0 0 100px rgba(59,130,246,0.3), inset 0 0 80px rgba(59,130,246,0.1)";
      } else {
        circle.style.background = "radial-gradient(circle at 35% 35%, rgba(168,85,247,0.4), rgba(126,34,206,0.18))";
        circle.style.boxShadow = "0 0 80px rgba(168,85,247,0.25), inset 0 0 60px rgba(168,85,247,0.08)";
      }

      const bg = document.getElementById("bg");
      if (phase === "inhale") bg.style.background = "radial-gradient(ellipse 80% 80% at 50% 50%, rgba(34,197,94,0.25) 0%, transparent 70%)";
      else if (phase === "exhale") bg.style.background = "radial-gradient(ellipse 80% 80% at 50% 50%, rgba(59,130,246,0.2) 0%, transparent 70%)";
      else bg.style.background = "radial-gradient(ellipse 80% 80% at 50% 50%, rgba(168,85,247,0.12) 0%, transparent 70%)";

      const t = i18n[state.lang];
      document.getElementById("phaseName").textContent = t[phase];
      document.getElementById("countdown").textContent = Math.max(0, dur - state.phaseSec);
      document.getElementById("cycles").textContent = state.cycle + " " + t.cycles;
    }

    function applyLang() {
      const t = i18n[state.lang];
      document.getElementById("title").textContent = t.title;
      document.getElementById("tagline").textContent = t.tagline;
      document.querySelectorAll(".patterns button").forEach(btn => {
        btn.textContent = t[btn.dataset.pattern];
      });
      document.querySelectorAll(".lang button").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.lang === state.lang);
      });
      update();
    }

    setInterval(() => {
      const durations = getDurations();
      const dur = getPhaseDuration();
      state.phaseSec++;
      if (state.phaseSec >= dur) {
        state.phaseSec = 0;
        if (state.phaseIdx + 1 >= durations.length || durations[state.phaseIdx + 1] === 0) {
          state.phaseIdx = 0;
          state.cycle++;
        } else {
          state.phaseIdx++;
        }
      }
      update();
    }, 1000);

    document.querySelectorAll(".patterns button").forEach(btn => {
      btn.addEventListener("click", () => {
        state.pattern = btn.dataset.pattern;
        state.phaseIdx = 0;
        state.phaseSec = 0;
        state.cycle = 0;
        document.querySelectorAll(".patterns button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        applyLang();
      });
    });

    document.querySelectorAll(".lang button").forEach(btn => {
      btn.addEventListener("click", () => {
        state.lang = btn.dataset.lang;
        localStorage.setItem("breathe-lang", state.lang);
        applyLang();
      });
    });

    applyLang();
  </script>
</body>
</html>
